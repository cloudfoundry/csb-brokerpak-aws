---
version: 1
name: csb-aws-mssql
id: 8b17758e-37a9-4c1c-af84-971d4a5552c1
description: CSB Amazon RDS for MSSQL
display_name: CSB Amazon RDS for MSSQL
image_url: file://service-images/csb.png
documentation_url: https://docs.vmware.com/en/Cloud-Service-Broker-for-VMware-Tanzu/index.html
provider_display_name: VMware
support_url: https://aws.amazon.com/sql/
tags: [aws, mssql, beta]
plan_updateable: true
provision:
  plan_inputs: []
  user_inputs:
  - field_name: engine
    required: true
    type: string
    details: The edition for the MSSQL instance.
    enum:
      sqlserver-ee: sqlserver-ee
      sqlserver-ex: sqlserver-ex
      sqlserver-se: sqlserver-se
      sqlserver-web: sqlserver-web
  - field_name: mssql_version
    required: true
    type: string
    details: |
      The version for the MSSQL instance. Can be any version supported by the provider.
      For more information about Microsoft SQL versions on Amazon RDS see https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_SQLServer.html#SQLServer.Concepts.General.VersionSupport
  - field_name: storage_gb
    required: true
    type: integer
    details: | 
      Size of storage volume for service instance.
      For more information about Amazon RDS DB instance storage for MSSQL see https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_Storage.html
    constraints:
      minimum: 20
      maximum: 16384
  - field_name: max_allocated_storage
    type: integer
    nullable: true
    details: |
      Upper limit to which Amazon RDS can automatically scale the storage of the DB instance.
      Must be greater than or equal to `storage_gb`. Set it to null or 0 to disable Storage Autoscaling.
  - field_name: storage_encrypted
    type: boolean
    default: true
    details: Enable encrypted storage
    prohibit_update: true
  - field_name: kms_key_id
    type: string
    default: ""
    details: |
      The ARN for the KMS encryption key (see https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.html)
      The `storage_encrypted` property must be enabled if the key is specified.
    prohibit_update: true
  - field_name: db_name
    type: string
    details: Name for your database
    default: vsbdb
    constraints:
      maxLength: 64
    prohibit_update: true
  - field_name: instance_name
    type: string
    details: Name for your MSSQL instance
    default: csb-mssql-${request.instance_id}
    constraints:
      maxLength: 63
      minLength: 1
      pattern: ^[a-zA-Z](-?[a-zA-Z0-9])*$
    prohibit_update: true
  - field_name: region
    type: string
    details: The region of AWS.
    default: us-west-2
    constraints:
      examples:
      - us-central1
      - asia-northeast1
      pattern: ^[a-z][a-z0-9-]+$
    prohibit_update: true
  - field_name: aws_access_key_id
    type: string
    details: AWS access key
    default: ${config("aws.access_key_id")}
  - field_name: aws_secret_access_key
    type: string
    details: AWS secret key
    default: ${config("aws.secret_access_key")}
  - field_name: aws_vpc_id
    type: string
    details: VPC ID for instance
    default: ""
  - field_name: instance_class
    required: true
    type: string
    details: |
      AWS DB instance class. Accepted values will depend on the selected engine and mssql_version.
      See: https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_SQLServer.html#SQLServer.Concepts.General.InstanceClasses
  - field_name: rds_subnet_group
    type: string
    details: AWS RDS subnet group already in existence to use
    default: ""
  - field_name: rds_vpc_security_group_ids
    type: string
    details: Comma delimited list of security group ID's for instance
    default: ""
    prohibit_update: true
  - field_name: deletion_protection
    type: boolean
    details: Whether deletion protection is enabled. The database cannot be deleted when this property is enabled.
    default: false
  - field_name: option_group_name
    type: string
    default: ""
    details: |
      Name of the DB option group to associate.
      MSSQL offers additional features such as SQL Server Audit, Transparent Data Encryption, etc.
      See AWS RDS options for the Microsoft SQL Server database engine for details:
      https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Appendix.SQLServer.Options.html
  - field_name: storage_type
    type: string
    details: |
      Type of storage to be used.
      One of "standard" (magnetic), "gp2" (general purpose SSD), "gp3" (general purpose SSD),
      or "io1" (provisioned IOPS SSD).
    default: "io1"
  - field_name: iops
    type: integer
    details: |
      The amount of provisioned IOPS. For this property to take effect, `storage_type` must be
      set to `io1` or `gp3`.
      Cannot be specified for `gp3` storage if the `storage_gb` value is below a per-engine threshold.
      See the RDS User Guide for details:
      https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_Storage.html#gp3-storage.
    default: 3000
  - field_name: publicly_accessible
    type: boolean
    details: Make instance public if true
    default: false
  computed_inputs:
  - name: labels
    overwrite: true
    type: object
    default: ${json.marshal(request.default_labels)}
  template_refs:
    outputs: terraform/mssql/provision/outputs.tf
    provider: terraform/mssql/provision/provider.tf
    versions: terraform/mssql/provision/versions.tf
    variables: terraform/mssql/provision/variables.tf
    main: terraform/mssql/provision/main.tf
    data: terraform/mssql/provision/data.tf
    validations: terraform/mssql/provision/validations.tf
  outputs:
  - field_name: name
    type: string
    details: The name of the database.
  - field_name: hostname
    type: string
    details: Hostname or IP address of the exposed mssql endpoint used by clients to connect to the service.
  - field_name: username
    type: string
    details: The username to authenticate to the database instance.
  - field_name: password
    type: string
    details: The password to authenticate to the database instance.
bind:
  plan_inputs: []
  user_inputs: []
  computed_inputs:
  - name: db_name
    type: string
    default: ${instance.details["name"]}
    overwrite: true
  - name: hostname
    type: string
    default: ${instance.details["hostname"]}
    overwrite: true
  - name: admin_username
    type: string
    default: ${instance.details["username"]}
    overwrite: true
  - name: admin_password
    type: string
    default: ${instance.details["password"]}
    overwrite: true
  template_refs:
    outputs: terraform/mssql/bind/outputs.tf
    provider: terraform/mssql/bind/provider.tf
    versions: terraform/mssql/bind/versions.tf
    variables: terraform/mssql/bind/variables.tf
    main: terraform/mssql/bind/main.tf
  outputs:
  - field_name: username
    type: string
    details: The username to authenticate to the database instance.
  - field_name: password
    type: string
    details: The password to authenticate to the database instance.
  - field_name: uri
    type: string
    details: The uri to connect to the database instance and database.
  - field_name: jdbcUrl
    type: string
    details: The jdbc url to connect to the database instance and database.
examples: []
